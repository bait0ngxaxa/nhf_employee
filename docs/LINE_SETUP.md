# LINE Messaging API Setup Guide

## ЁЯУ▒ р╕ар╕▓р╕Юр╕гр╕зр╕б
р╕гр╕░р╕Ър╕Ъ NHF IT Support р╣Гр╕Кр╣Й LINE Messaging API р╕кр╕│р╕лр╕гр╕▒р╕Ър╕Бр╕▓р╕гр╣Бр╕Ир╣Йр╕Зр╣Ар╕Хр╕╖р╕нр╕Щ! р╕Ьр╕╣р╣Йр╣Гр╕Кр╣Йр╕Ир╕░р╣Др╕Фр╣Йр╕гр╕▒р╕Ър╕Бр╕▓р╕гр╣Бр╕Ир╣Йр╕Зр╣Ар╕Хр╕╖р╕нр╕Щр╕Чр╕▒р╣Йр╕Зр╕Чр╕▓р╕З Email р╣Бр╕ер╕░ LINE р╣Ар╕бр╕╖р╣Ир╕н:
- р╕кр╕гр╣Йр╕▓р╕З ticket р╣Гр╕лр╕бр╣И (р╕вр╕╖р╕Щр╕вр╕▒р╕Щр╕Бр╕▓р╕гр╕кр╕гр╣Йр╕▓р╕З)
- р╕нр╕▒р╕Юр╣Ар╕Фр╕Чр╕кр╕Цр╕▓р╕Щр╕░ ticket
- ticket р╕Др╕зр╕▓р╕бр╕кр╕│р╕Др╕▒р╕Нр╕кр╕╣р╕З/р╣Ар╕гр╣Ир╕Зр╕Фр╣Ир╕зр╕Щ (р╣Бр╕Ир╣Йр╕Зр╕Чр╕╡р╕б IT)

## ЁЯЪА р╕зр╕┤р╕Шр╕╡р╕Бр╕▓р╕гр╕Хр╕▒р╣Йр╕Зр╕Др╣Ир╕▓

### 1. LINE Messaging API (р╕кр╕│р╕лр╕гр╕▒р╕Ъ LINE Official Account)

#### р╕Вр╕▒р╣Йр╕Щр╕Хр╕нр╕Щр╕Бр╕▓р╕гр╕кр╕гр╣Йр╕▓р╕З LINE Official Account:
1. р╣Др╕Ыр╕Чр╕╡р╣И [LINE Developers Console](https://developers.line.biz/console/)
2. р╕ер╣Зр╕нр╕Бр╕нр╕┤р╕Щр╕Фр╣Йр╕зр╕вр╕Ър╕▒р╕Нр╕Кр╕╡ LINE Business Account
3. р╕кр╕гр╣Йр╕▓р╕З Provider р╣Гр╕лр╕бр╣И (р╕лр╕гр╕╖р╕нр╣Ар╕ер╕╖р╕нр╕Бр╕Чр╕╡р╣Ир╕бр╕╡р╕нр╕вр╕╣р╣И)
4. р╕Др╕ер╕┤р╕Б **"Create Channel"** тЖТ р╣Ар╕ер╕╖р╕нр╕Б **"Messaging API"**
5. р╕Бр╕гр╕нр╕Бр╕Вр╣Йр╕нр╕бр╕╣р╕е Channel:
   - **Channel name**: "NHF IT Support"
   - **Channel description**: "р╕гр╕░р╕Ър╕Ър╣Бр╕Ир╣Йр╕Зр╣Ар╕Хр╕╖р╕нр╕Щ IT Support"
   - **Category**: "IT/Technology"
   - **Subcategory**: р╣Ар╕ер╕╖р╕нр╕Бр╕Хр╕▓р╕бр╕Др╕зр╕▓р╕бр╣Ар╕лр╕бр╕▓р╕░р╕кр╕б
6. р╕нр╣Ир╕▓р╕Щр╣Бр╕ер╕░р╕вр╕нр╕бр╕гр╕▒р╕Ъ Terms of Use
7. р╕Др╕ер╕┤р╕Б **"Create"**

#### р╕Бр╕▓р╕гр╕Хр╕▒р╣Йр╕Зр╕Др╣Ир╕▓ Channel:
1. р╣Др╕Ыр╕Чр╕╡р╣Ир╣Бр╕Чр╣Зр╕Ъ **"Messaging API"**
2. р╣Гр╕Щр╕кр╣Ир╕зр╕Щ **"Channel Access Token"**:
   - р╕Др╕ер╕┤р╕Б **"Issue"** р╣Ар╕Юр╕╖р╣Ир╕нр╕кр╕гр╣Йр╕▓р╕З Token
   - **р╕Др╕▒р╕Фр╕ер╕нр╕Б Token** р╕бр╕▓р╣Гр╕кр╣Ир╣Гр╕Щ `.env.local`:
   ```env
   LINE_CHANNEL_ACCESS_TOKEN="р╣Гр╕кр╣И_token_р╕Хр╕гр╕Зр╕Щр╕╡р╣Й"
   ```

3. р╣Гр╕Щр╕кр╣Ир╕зр╕Щ **"Webhook Settings"**:
   - р╣Ар╕Ыр╕┤р╕Фр╣Гр╕Кр╣Йр╕Зр╕▓р╕Щ **"Use webhook"**
   - р╣Гр╕кр╣И Webhook URL (р╕Цр╣Йр╕▓р╕бр╕╡):
   ```env
   LINE_WEBHOOK_URL="https://your-domain.com/api/line/webhook"
   ```

### 2. р╕Бр╕▓р╕гр╕лр╕▓ User ID р╕кр╕│р╕лр╕гр╕▒р╕Ър╕кр╣Ир╕Зр╕Вр╣Йр╕нр╕Др╕зр╕▓р╕б

#### р╕зр╕┤р╕Шр╕╡р╕Чр╕╡р╣И 1: р╣Гр╕Кр╣Й Broadcast (р╕кр╣Ир╕Зр╣Гр╕лр╣Йр╕Ьр╕╣р╣Йр╕Хр╕┤р╕Фр╕Хр╕▓р╕б OA р╕Чр╕▒р╣Йр╕Зр╕лр╕бр╕Ф)
- р╣Др╕бр╣Ир╕Хр╣Йр╕нр╕Зр╕Хр╕▒р╣Йр╕З `LINE_IT_TEAM_USER_ID`
- р╕гр╕░р╕Ър╕Ър╕Ир╕░р╣Гр╕Кр╣Й Broadcast API р╣Бр╕Чр╕Щ

#### р╕зр╕┤р╕Шр╕╡р╕Чр╕╡р╣И 2: р╕кр╣Ир╕Зр╣Гр╕лр╣Й User р╣Ар╕Йр╕Юр╕▓р╕░ (р╣Бр╕Щр╕░р╕Щр╕│)
1. р╣Гр╕лр╣Йр╕Чр╕╡р╕б IT Add LINE OA р╣Ар╕Ыр╣Зр╕Щр╣Ар╕Юр╕╖р╣Ир╕нр╕Щ
2. р╕кр╣Ир╕Зр╕Вр╣Йр╕нр╕Др╕зр╕▓р╕бр╣Гр╕Фр╣Ж р╣Др╕Ыр╕вр╕▒р╕З OA
3. р╕Фр╕╣ User ID р╕Ир╕▓р╕Б Webhook events
4. р╣Гр╕кр╣И User ID р╣Гр╕Щ `.env.local`:
   ```env
   LINE_IT_TEAM_USER_ID="U1234567890abcdef1234567890abcdef"
   ```

## ЁЯзк р╕Бр╕▓р╕гр╕Чр╕Фр╕кр╕нр╕Ъ

### р╕Чр╕Фр╕кр╕нр╕Ъ LINE Messaging API:
```bash
npm run test:line
```

### р╕Чр╕Фр╕кр╕нр╕Ър╕Чр╕▒р╣Йр╕Зр╕гр╕░р╕Ър╕Ъ (Email + LINE):
```bash
npm run test:notifications
```

### р╕Чр╕Фр╕кр╕нр╕Ър╣Ар╕Йр╕Юр╕▓р╕░ Email:
```bash
npm run email:diagnostic
```

## ЁЯУЛ р╕Хр╕▒р╕зр╕нр╕вр╣Ир╕▓р╕Зр╕Вр╣Йр╕нр╕Др╕зр╕▓р╕б LINE р╣Бр╕Ър╕Ъ Flex Message

### ЁЯОл Ticket р╣Гр╕лр╕бр╣И:
р╕Вр╣Йр╕нр╕Др╕зр╕▓р╕бр╕Ир╕░р╣Бр╕кр╕Фр╕Зр╣Ар╕Ыр╣Зр╕Щ Flex Message р╕Чр╕╡р╣Ир╕кр╕зр╕вр╕Зр╕▓р╕б р╕Юр╕гр╣Йр╕нр╕б:
- р╕лр╕▒р╕зр╕Вр╣Йр╕нр╕кр╕╡р╕Яр╣Йр╕▓ р╣Бр╕ер╕░ р╕лр╕бр╕▓р╕вр╣Ар╕ер╕В Ticket
- р╕гр╕▓р╕вр╕ер╕░р╣Ар╕нр╕╡р╕вр╕Фр╕Др╕гр╕Ър╕Цр╣Йр╕зр╕Щ
- р╕Ыр╕╕р╣Ир╕бр╕ер╕┤р╣Йр╕Зр╕Др╣Мр╣Др╕Ыр╕вр╕▒р╕Зр╕гр╕░р╕Ър╕Ъ
- р╣Вр╕Чр╕Щр╕кр╕╡р╕Хр╕▓р╕бр╕Др╕зр╕▓р╕бр╕кр╕│р╕Др╕▒р╕Н

### ЁЯФД р╕нр╕▒р╕Юр╣Ар╕Фр╕Чр╕кр╕Цр╕▓р╕Щр╕░:
р╣Бр╕кр╕Фр╕Зр╕Бр╕▓р╕гр╣Ар╕Ыр╕ер╕╡р╣Ир╕вр╕Щр╕кр╕Цр╕▓р╕Щр╕░р╣Бр╕Ър╕Ър╕Кр╕▒р╕Фр╣Ар╕Ир╕Щ р╕Юр╕гр╣Йр╕нр╕бр╕ер╕╣р╕Бр╕ир╕г

## ЁЯФз р╕Бр╕▓р╕гр╣Бр╕Бр╣Йр╕Ыр╕▒р╕Нр╕лр╕▓

### LINE Messaging API р╕кр╣Ир╕Зр╣Др╕бр╣Ир╣Др╕Фр╣Й:
- р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ъ `LINE_CHANNEL_ACCESS_TOKEN` р╣Гр╕Щ `.env.local`
- р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╕зр╣Ир╕▓ Token р╕вр╕▒р╕Зр╣Др╕бр╣Ир╕лр╕бр╕Фр╕нр╕▓р╕вр╕╕
- р╕ер╕нр╕Зр╕кр╕гр╣Йр╕▓р╕З Token р╣Гр╕лр╕бр╣И

### LINE Webhook р╣Др╕бр╣Ир╕Чр╕│р╕Зр╕▓р╕Щ:
- р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ъ `LINE_WEBHOOK_URL` р╣Гр╕Щ `.env.local`
- р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╕зр╣Ир╕▓ URL р╕кр╕▓р╕бр╕▓р╕гр╕Цр╣Ар╕Вр╣Йр╕▓р╕Цр╕╢р╕Зр╣Др╕Фр╣Йр╕Ир╕▓р╕Бр╕ар╕▓р╕вр╕Щр╕нр╕Б
- р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ъ SSL Certificate (р╕Хр╣Йр╕нр╕Зр╣Ар╕Ыр╣Зр╕Щ HTTPS)

### р╣Др╕бр╣Ир╣Др╕Фр╣Йр╕гр╕▒р╕Ър╕Бр╕▓р╕гр╣Бр╕Ир╣Йр╕Зр╣Ар╕Хр╕╖р╕нр╕Щ:
- р╕гр╕▒р╕Щр╕Др╕│р╕кр╕▒р╣Ир╕З `npm run test:notifications` р╣Ар╕Юр╕╖р╣Ир╕нр╕Чр╕Фр╕кр╕нр╕Ъ
- р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ъ console log р╣Гр╕Щр╕гр╕░р╕Ър╕Ъ
- р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╕зр╣Ир╕▓р╕Чр╕▒р╣Йр╕З Email р╣Бр╕ер╕░ LINE settings р╕Цр╕╣р╕Бр╕Хр╣Йр╕нр╕З

## ЁЯУЭ р╕лр╕бр╕▓р╕вр╣Ар╕лр╕Хр╕╕

- **LINE Messaging API** р╣Ар╕лр╕бр╕▓р╕░р╕кр╕│р╕лр╕гр╕▒р╕Ъ LINE Official Account р╕Чр╕╡р╣Ир╕Хр╣Йр╕нр╕Зр╕Бр╕▓р╕г rich content р╣Бр╕ер╕░ interactive features
- **LINE Webhook** р╣Ар╕лр╕бр╕▓р╕░р╕кр╕│р╕лр╕гр╕▒р╕Ъ LINE Official Account р╕Чр╕╡р╣Ир╕Хр╣Йр╕нр╕Зр╕Бр╕▓р╕гр╕Бр╕▓р╕гр╕Хр╕нр╕Ър╕кр╕Щр╕нр╕Зр╣Бр╕Ър╕Ъ interactive
- р╕гр╕░р╕Ър╕Ър╕Ир╕░р╕кр╣Ир╕Зр╕Чр╕▒р╣Йр╕З Email р╣Бр╕ер╕░ LINE р╕Др╕зр╕Ър╕Др╕╣р╣Ир╕Бр╕▒р╕Щ (р╣Др╕бр╣Ир╕Вр╕╢р╣Йр╕Щр╕Бр╕▒р╕Ър╕Бр╕▒р╕Щ)
- р╕лр╕▓р╕Бр╕Бр╕▓р╕гр╕кр╣Ир╕Зр╕Бр╕▓р╕гр╣Бр╕Ир╣Йр╕Зр╣Ар╕Хр╕╖р╕нр╕Щр╕ер╣Йр╕бр╣Ар╕лр╕ер╕з р╕Ир╕░р╣Др╕бр╣Ир╕кр╣Ир╕Зр╕Ьр╕ер╕Хр╣Ир╕нр╕Бр╕▓р╕гр╕Чр╕│р╕Зр╕▓р╕Щр╕лр╕ер╕▒р╕Бр╕Вр╕нр╕Зр╕гр╕░р╕Ър╕Ъ

## тЬЕ р╕Бр╕▓р╕гр╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╕Бр╕▓р╕гр╕Чр╕│р╕Зр╕▓р╕Щ

р╕гр╕░р╕Ър╕Ър╕Ир╕░р╣Бр╕кр╕Фр╕З log р╣Гр╕Щр╕Др╕нр╕Щр╣Вр╕Лр╕ер╣Ар╕бр╕╖р╣Ир╕нр╕кр╣Ир╕Зр╕Бр╕▓р╕гр╣Бр╕Ир╣Йр╕Зр╣Ар╕Хр╕╖р╕нр╕Щ:
```
ЁЯУз Email result: SUCCESS
ЁЯУ▒ LINE result: SUCCESS
тЪб IT team notifications sent
```

р╕кр╕│р╕лр╕гр╕▒р╕Ър╕Бр╕▓р╕г debug р╣Ар╕Юр╕┤р╣Ир╕бр╣Ар╕Хр╕┤р╕б р╣Гр╕лр╣Йр╕Фр╕╣р╕Чр╕╡р╣И console log р╕Вр╕нр╕З Next.js development server

## ЁЯФз р╕Бр╕▓р╕гр╣Бр╕Бр╣Йр╕Ыр╕▒р╕Нр╕лр╕▓

### LINE Notify р╕кр╣Ир╕Зр╣Др╕бр╣Ир╣Др╕Фр╣Й:
- р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ъ `LINE_NOTIFY_TOKEN` р╣Гр╕Щ `.env.local`
- р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╕зр╣Ир╕▓ Token р╕вр╕▒р╕Зр╣Др╕бр╣Ир╕лр╕бр╕Фр╕нр╕▓р╕вр╕╕
- р╕ер╕нр╕Зр╕кр╕гр╣Йр╕▓р╕З Token р╣Гр╕лр╕бр╣И

### LINE Webhook р╣Др╕бр╣Ир╕Чр╕│р╕Зр╕▓р╕Щ:
- р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ъ `LINE_WEBHOOK_URL` р╣Гр╕Щ `.env.local`
- р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╕зр╣Ир╕▓ URL р╕кр╕▓р╕бр╕▓р╕гр╕Цр╣Ар╕Вр╣Йр╕▓р╕Цр╕╢р╕Зр╣Др╕Фр╣Йр╕Ир╕▓р╕Бр╕ар╕▓р╕вр╕Щр╕нр╕Б
- р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ъ SSL Certificate (р╕Хр╣Йр╕нр╕Зр╣Ар╕Ыр╣Зр╕Щ HTTPS)

### р╣Др╕бр╣Ир╣Др╕Фр╣Йр╕гр╕▒р╕Ър╕Бр╕▓р╕гр╣Бр╕Ир╣Йр╕Зр╣Ар╕Хр╕╖р╕нр╕Щ:
- р╕гр╕▒р╕Щр╕Др╕│р╕кр╕▒р╣Ир╕З `npm run test:notifications` р╣Ар╕Юр╕╖р╣Ир╕нр╕Чр╕Фр╕кр╕нр╕Ъ
- р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ъ console log р╣Гр╕Щр╕гр╕░р╕Ър╕Ъ
- р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╕зр╣Ир╕▓р╕Чр╕▒р╣Йр╕З Email р╣Бр╕ер╕░ LINE settings р╕Цр╕╣р╕Бр╕Хр╣Йр╕нр╕З

## ЁЯУЭ р╕лр╕бр╕▓р╕вр╣Ар╕лр╕Хр╕╕

- **LINE Notify** р╣Ар╕лр╕бр╕▓р╕░р╕кр╕│р╕лр╕гр╕▒р╕Ър╕кр╣Ир╕Зр╕Вр╣Йр╕нр╕Др╕зр╕▓р╕бр╣Бр╕Ир╣Йр╕Зр╣Ар╕Хр╕╖р╕нр╕Щр╕Чр╕▒р╣Ир╕зр╣Др╕Ы
- **LINE Webhook** р╣Ар╕лр╕бр╕▓р╕░р╕кр╕│р╕лр╕гр╕▒р╕Ъ LINE Official Account р╕Чр╕╡р╣Ир╕Хр╣Йр╕нр╕Зр╕Бр╕▓р╕гр╕Бр╕▓р╕гр╕Хр╕нр╕Ър╕кр╕Щр╕нр╕Зр╣Бр╕Ър╕Ъ interactive
- р╕гр╕░р╕Ър╕Ър╕Ир╕░р╕кр╣Ир╕Зр╕Чр╕▒р╣Йр╕З Email р╣Бр╕ер╕░ LINE р╕Др╕зр╕Ър╕Др╕╣р╣Ир╕Бр╕▒р╕Щ (р╣Др╕бр╣Ир╕Вр╕╢р╣Йр╕Щр╕Бр╕▒р╕Ър╕Бр╕▒р╕Щ)
- р╕лр╕▓р╕Бр╕Бр╕▓р╕гр╕кр╣Ир╕Зр╕Бр╕▓р╕гр╣Бр╕Ир╣Йр╕Зр╣Ар╕Хр╕╖р╕нр╕Щр╕ер╣Йр╕бр╣Ар╕лр╕ер╕з р╕Ир╕░р╣Др╕бр╣Ир╕кр╣Ир╕Зр╕Ьр╕ер╕Хр╣Ир╕нр╕Бр╕▓р╕гр╕кр╕гр╣Йр╕▓р╕З/р╕нр╕▒р╕Юр╣Ар╕Фр╕Ч ticket

## тЬЕ р╕Бр╕▓р╕гр╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╕Бр╕▓р╕гр╕Чр╕│р╕Зр╕▓р╕Щ

р╕гр╕░р╕Ър╕Ър╕Ир╕░р╣Бр╕кр╕Фр╕З log р╣Гр╕Щр╕Др╕нр╕Щр╣Вр╕Лр╕ер╣Ар╕бр╕╖р╣Ир╕нр╕кр╣Ир╕Зр╕Бр╕▓р╕гр╣Бр╕Ир╣Йр╕Зр╣Ар╕Хр╕╖р╕нр╕Щ:
```
ЁЯУз Email result: SUCCESS
ЁЯУ▒ LINE result: SUCCESS
тЪб IT team notifications sent
```

р╕кр╕│р╕лр╕гр╕▒р╕Ър╕Бр╕▓р╕г debug р╣Ар╕Юр╕┤р╣Ир╕бр╣Ар╕Хр╕┤р╕б р╣Гр╕лр╣Йр╕Фр╕╣р╕Чр╕╡р╣И console log р╕Вр╕нр╕З Next.js development server